name: Update vbz_frequenzen_hardbruecke data

on:
  schedule:
    - cron:  '*/5 * * *'

jobs:
  update_data_r:
    runs-on: macos

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2
    
    # Setup R and its depedencies
    - uses: r-lib/actions/setup-r@master
    - name: Install R dependencies
      run: |
        install.packages("httr")
        install.packages("stringr")
        install.packages("jsonlite")
      shell: Rscript {0}
      
    # Prepare data
    - name: Prepare data
      env:
        SSZ_USER: ${{ secrets.vbz_ssz_user }}
        SSZ_PASS: ${{ secrets.vbz_ssz_password }}
      run: Rscript automation/vbz_frequenzen_hardbruecke/VBZ_Frequenzen_Hardbruecke_SSZ-Zugang.R

    - name: Upload CSV generated by R
        uses: actions/upload-artifact@v1
        with:
          name: vbz_frequenzen_hardbruecke_r
          path: Frequenzen_Hardbruecke_2020.csv

  update_data_py:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7]

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r automation/automation-requirements.txt
        
    - name: Prepare data
      env:
        SSZ_USER: ${{ secrets.vbz_ssz_user }}
        SSZ_PASS: ${{ secrets.vbz_ssz_password }}
      run: |
        python automation/vbz_frequenzen_hardbruecke/fetch_from_api.py > frequenzen_py.csv
        
    - name: Upload CSV generated by R
        uses: actions/upload-artifact@v1
        with:
          name: vbz_frequenzen_hardbruecke_py
          path: frequenzen_py.csv
