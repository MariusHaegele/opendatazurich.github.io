name: Update vbz_frequenzen_hardbruecke data

on:
  schedule:
    - cron:  '0 5 * * *' # 05:00 UTC

jobs:
  update_data_py:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7]

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r automation/automation-requirements.txt
        
    - name: Prepare data
      env:
        SSZ_USER: ${{ secrets.vbz_ssz_user }}
        SSZ_PASS: ${{ secrets.vbz_ssz_password }}
      run: |
        python automation/vbz_frequenzen_hardbruecke/fetch_from_api.py > Frequenzen_Hardbruecke_2020.csv
        
    - name: Upload file to CKAN
      env:
        CKAN_BASE_URL: ${{ secrets.vbz_ckan_url }}
        CKAN_API_KEY: ${{ secrets.vbz_ckan_api_key }}
      run: |
        python automation/vbz_frequenzen_hardbruecke/upload_resource_to_ckan.py -f Frequenzen_Hardbruecke_2020.csv -d vbz_frequenzen_hardbruecke
